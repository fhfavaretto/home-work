-- RANKING PRODUTOS MAIS VENDIDOS 12 MESES EM VALOR -- FATURAMENTO
SELECT D2_COD, B1_DESC, SUM(D2_TOTAL) D2_TOTAL FROM SD2010 
INNER JOIN SB1010 ON
SB1010.D_E_L_E_T_ =''
AND B1_COD = D2_COD
INNER JOIN SF4010 ON
SF4010.D_E_L_E_T_ =''
AND F4_CODIGO = D2_TES
AND F4_DUPLIC = 'S'
WHERE SD2010.D_E_L_E_T_ =''
AND D2_EMISSAO BETWEEN '20220501' AND '20230430' -- COLOCAR VARIAVEL DE 12 MESES (DDATABASE MES CORRENTE -> 12 MESES PARA TRAS)
GROUP BY D2_COD, B1_DESC
ORDER BY D2_TOTAL DESC