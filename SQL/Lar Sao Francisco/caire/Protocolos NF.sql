
-- Filial 
-- Usuario
-- Nota - Digitação - Emissão - Vencimento 1ª parcela - Fornecedor - Valor Bruto - Valor Financeiro - Diferença - IRRF - INSS - ISS - Natureza

SELECT 
F1_FILIAL FILIAL,
F1_SERIE SERIE,
F1_DOC NOTA,
F1__USER USUARIO,
F1_DTDIGIT DIGITACAO,
F1_EMISSAO EMISSAO,
MIN(E2_VENCTO) VENCIMENTO,
(SELECT A2_NOME FROM SA2010 WHERE A2_COD = F1_FORNECE AND A2_LOJA = F1_LOJA AND SUBSTR(A2_FILIAL,1,2) = SUBSTR(F1_FILIAL,1,2) AND SA2010.D_E_L_E_T_<>'*') FORNECEDOR,
F1_VALBRUT/*/(SELECT COUNT(E2_PARCELA) FROM SE2010 WHERE E2_FILIAL = F1_FILIAL AND E2_PREFIXO = F1_SERIE AND E2_NUM = F1_DOC AND E2_FORNECE = F1_FORNECE AND E2_LOJA = F1_LOJA AND SE2010.D_E_L_E_T_<>'*' AND E2_TIPO = 'NF')*/ VLR_BRUTO,
SUM(E2_VALOR) FINANCEIRO,
SUM(E2_IRRF) IRRF,
SUM(E2_INSS) INSS,
SUM(E2_ISS) ISS,
SUM(E2_PIS+E2_COFINS+E2_CSLL) PCC,
(SELECT ED_DESCRIC FROM SED010 WHERE E2_NATUREZ = ED_CODIGO AND SED010.D_E_L_E_T_<>'*' AND SUBSTR(F1_FILIAL,1,2) = SUBSTR(ED_FILIAL,1,2)) NATUREZA

FROM SF1010

JOIN SE2010 ON E2_FILIAL = F1_FILIAL AND E2_NUM = F1_DOC AND E2_PREFIXO = F1_SERIE AND E2_FORNECE = F1_FORNECE AND E2_LOJA = F1_LOJA AND SE2010.D_E_L_E_T_<>'*' AND E2_TIPO <>'FT' 

WHERE SF1010.D_E_L_E_T_<>'*'  
/*
 AND SF1.F1_FILIAL BETWEEN MV_PAR07 AND MV_PAR08
 AND SF1.F1_EMISSAO BETWEEN MV_PAR09 AND MV_PAR10 
 AND SF1.F1_DTDIGIT BETWEEN MV_PAR01 AND MV_PAR02
 AND SE2.E2_NATUREZ BETWEEN MV_PAR05 AND MV_PAR06 
 AND SF1.F1__USER   BETWEEN MV_PAR03 AND MV_PAR04
*/

GROUP BY 
F1_FILIAL,
F1_SERIE,
F1_DOC,
F1__USER,
F1_DTDIGIT,
F1_EMISSAO,
F1_FORNECE,
F1_LOJA,
F1_VALBRUT,
E2_NATUREZ

ORDER BY

F1_FILIAL,
F1_SERIE,
F1_DOC,
F1_FORNECE,
F1_LOJA,
F1__USER,
F1_DTDIGIT,
F1_EMISSAO,
F1_VALBRUT,
E2_NATUREZ

;

SELECT * FROM SF1010;

SELECT * FROM SE5010 WHERE E5_FILIAL = '11034' AND E5_NUMERO = '000000574';


      SF1.F1_FILIAL BETWEEN MV_PAR07 AND MV_PAR08
 AND SF1.F1_EMISSAO BETWEEN MV_PAR09 AND MV_PAR10 
 AND SF1.F1_DTDIGIT BETWEEN MV_PAR01 AND MV_PAR02
 AND SE2.E2_NATUREZ BETWEEN MV_PAR05 AND MV_PAR06 
 AND SF1.F1__USER   BETWEEN MV_PAR03 AND MV_PAR04
;

SELECT * FROM SZ1010 WHERE Z1_X_PEDC = '140334' AND R_E_C_N_O_ <> 50888;
UPDATE SZ1010 SET Z1_X_ESTOR = 'S' WHERE Z1_X_PEDC = '140334' AND R_E_C_N_O_ <> 50888;

SELECT * FROM CTT010;


SELECT * FROM SE2010 WHERE 
