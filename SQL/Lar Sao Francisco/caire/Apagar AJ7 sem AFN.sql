/*CREATE TABLE AFG010_BKP_030517 AS SELECT * FROM AFG010;*/
/*CREATE TABLE AJ7010_BKP_030517 AS SELECT * FROM AJ7010;*/
/*CREATE TABLE AFN010_BKP_030517 AS SELECT * FROM AFN010;*/
/*CREATE TABLE SC7010_BKP_030517 AS SELECT * FROM SC7010;*/

SELECT AJ7_FILIAL, AJ7_PROJET, AJ7_TAREFA, AJ7_NUMPC, AJ7_ITEMPC, AJ7_COD, AJ7_QUANT, AJ7_TRT, AJ7_QTSEGU, AJ7_REVISA, AFN_DOC, AJ7010.R_E_C_N_O_, SD1.D1_DOC, TO_DATE(SD1.D1_EMISSAO,'YYYYMMDD') EMISSAO_NOTA

FROM AJ7010 

LEFT JOIN SD1010 SD1 ON D1_PEDIDO = AJ7_NUMPC 
AND AJ7_ITEMPC = D1_ITEMPC 
AND AJ7_FILIAL = D1_FILIAL 
AND SD1.D_E_L_E_T_=' '

LEFT JOIN AFN010 AFN ON SD1.D1_FILIAL = AFN.AFN_FILIAL
			AND SD1.D1_DOC = AFN.AFN_DOC
			AND SD1.D1_SERIE = AFN.AFN_SERIE
			AND SD1.D1_ITEM = AFN.AFN_ITEM
			AND SD1.D1_FORNECE = AFN.AFN_FORNEC
			AND SD1.D1_LOJA = AFN.AFN_LOJA
			AND SD1.D1_COD = AFN.AFN_COD
			AND AFN.D_E_L_E_T_ = ' '
      
WHERE AFN_DOC IS NULL AND D1_DOC IS NOT NULL AND AJ7_NUMPC IS NOT NULL AND Aj7010.D_E_L_E_T_ = ' ' AND D1_EMISSAO > '20170101' 
ORDER BY AJ7_FILIAL, AJ7_PROJET, AJ7_NUMPC
; --U_SetPMSX("20170501")

SELECT * FROM AFN010 WHERE AFN_FILIAL = '11004' AND AFN_DOC = '000007180' AND D_E_L_E_T_=' ';
SELECT * FROM SD1010 WHERE D1_DOC = '000007180' AND D1_FILIAL = '11004';
SELECT * FROM AJ7010 WHERE AJ7_NUMPC = '124382';
SELECT * FROM SC7010 WHERE C7_NUM = '124382';
SELECT * FROM AJ7010 WHERE AJ7_NUMPC = '128409';
SELECT * FROM SC7010 WHERE C7_NUM = '128409';


UPDATE AFG010 SET D_E_L_E_T_='*',R_E_C_D_E_L_=R_E_C_N_O_ WHERE R_E_C_N_O_ IN (92521,92522,73503,73507,73497,73498,73499,73496,73504,73509,83103,73501);
/*
SELECT AFG010.R_E_C_N_O_ FROM AFG010 JOIN SC7010 ON C7_ITEMSC = AFG_ITEMSC AND C7_NUMSC = AFG_NUMSC AND C7_FILIAL = AFG_FILIAL AND SC7010.D_E_L_E_T_=' '
LEFT JOIN AJ7010 ON AJ7_FILIAL = C7_FILIAL AND AJ7_NUMPC = C7_NUM AND AJ7_ITEMPC = C7_ITEM AND AJ7010.D_E_L_E_T_=' '
WHERE AFG010.D_E_L_E_T_=' ' AND AJ7_NUMPC IS NULL)
*/


SELECT AFG_FILIAL, AFG_PROJET, AFG_TAREFA, AFG_NUMSC, AFG_ITEMSC, 
AFG_COD, AFG_QUANT, AFG_REVISA, C7_X_NTRZ, AJ7_FILIAL, AJ7_PROJET,C7_NUM, C7_EMISSAO,AFG010.R_E_C_N_O_,
AJ7_TAREFA, AJ7_NUMPC FROM AFG010 JOIN SC7010 ON C7_ITEMSC = AFG_ITEMSC
AND C7_NUMSC = AFG_NUMSC AND C7_FILIAL = AFG_FILIAL AND SC7010.D_E_L_E_T_=' '
LEFT JOIN AJ7010 ON AJ7_FILIAL = C7_FILIAL AND AJ7_NUMPC = C7_NUM AND AJ7_ITEMPC = C7_ITEM AND AJ7010.D_E_L_E_T_=' '
WHERE AFG010.D_E_L_E_T_=' ' AND AJ7_NUMPC IS NULL;

SELECT * FROM SC7010 WHERE C7_X_NTRZ = ' ' AND D_E_L_E_T_=' ';
SELECT * FROM SC1010 WHERE C1_X_NTRZ = ' ' AND D_E_L_E_T_=' ';
UPDATE SC1010 SET C1_X_NTRZ = (SELECT B1__NATURE FROM SB1010 WHERE B1_COD = C1_PRODUTO AND SUBSTR(B1_FILIAL,1,2) = '12' AND D_E_L_E_T_=' ')  WHERE C1_X_NTRZ = ' ' AND D_E_L_E_T_=' ' AND C1_FILENT = '12001';  

SELECT * FROM SC1010 WHERE C1_X_NTRZ = ' ';

SELECT * FROM SC7010 WHERE C7_X_NTRZ =' ' AND D_E_L_E_T_=' ' ;
UPDATE SC7010 SET C7_X_NTRZ = NVL((SELECT C1_X_NTRZ FROM SC1010 WHERE C1_NUM = C7_NUMSC AND C1_ITEM = C7_ITEMSC AND C1_FILENT = C7_FILIAL AND SC1010.D_E_L_E_T_=' '),(SELECT B1__NATURE FROM SB1010 WHERE B1_COD = C7_PRODUTO AND SUBSTR(B1_FILIAL,1,2) = SUBSTR(C7_FILIAL,1,2) AND SB1010.D_E_L_E_T_=' ')) WHERE C7_X_NTRZ = ' ' AND D_E_L_E_T_=' ' AND C7_NUMSC NOT IN('071070','071107');

SELECT * FROM AJ7010 WHERE AJ7_NUMPC IN ('113589') AND D_E_L_E_T_=' ';
UPDATE AJ7010 SET D_E_L_E_T_='*',R_E_C_D_E_L_=R_E_C_N_O_ WHERE AJ7_NUMPC IN ('117252','117268','117267');


SELECT C1_FILENT, C1_NUM, TO_DATE(C1_EMISSAO,'YYYYMMDD') EMISSAO, COUNT(C1_ITEM) ITENS_PEDIDO, NVL((SELECT COUNT(AFG_ITEMSC) FROM AFG010 
WHERE AFG_FILIAL = C1_FILENT AND AFG_NUMSC = C1_NUM  AND AFG010.D_E_L_E_T_=' '
GROUP BY AFG_FILIAL, AFG_NUMSC, C1_FILENT, C1_NUM),0) QTD_AMARRADA,COUNT(C1_ITEM)- NVL((SELECT COUNT(AFG_ITEMSC) FROM AFG010 
WHERE AFG_FILIAL = C1_FILENT AND AFG_NUMSC = C1_NUM  AND AFG010.D_E_L_E_T_=' '
GROUP BY AFG_FILIAL, AFG_NUMSC, C1_FILENT, C1_NUM),0)DIFERENCA, C1_X_NTRZ FROM SC1010 
WHERE SC1010.D_E_L_E_T_=' ' GROUP BY C1_FILENT, C1_NUM, C1_EMISSAO, C1_X_NTRZ;


SELECT C7_FILIAL, C7_NUM, (SELECT MAX(AJ7_PROJET) FROM AJ7010 
WHERE AJ7_FILIAL = C7_FILIAL AND AJ7_NUMPC = C7_NUM  AND AJ7010.D_E_L_E_T_=' '
GROUP BY AJ7_FILIAL, AJ7_NUMPC, C7_FILIAL, C7_NUM) PMS, TO_DATE(C7_EMISSAO,'YYYYMMDD') EMISSAO, COUNT(C7_ITEM) ITENS_PEDIDO, NVL((SELECT COUNT(AJ7_ITEMPC) FROM AJ7010 
WHERE AJ7_FILIAL = C7_FILIAL AND AJ7_NUMPC = C7_NUM  AND AJ7010.D_E_L_E_T_=' '
GROUP BY AJ7_FILIAL, AJ7_NUMPC, C7_FILIAL, C7_NUM),0) QTD_AMARRADA,COUNT(C7_ITEM)- NVL((SELECT COUNT(AJ7_ITEMPC) FROM AJ7010 
WHERE AJ7_FILIAL = C7_FILIAL AND AJ7_NUMPC = C7_NUM  AND AJ7010.D_E_L_E_T_=' '
GROUP BY AJ7_FILIAL, AJ7_NUMPC, C7_FILIAL, C7_NUM),0) DIFERENCA, SC7010.C7_X_DTCON DATA_AMARRACAO FROM SC7010 
WHERE SC7010.D_E_L_E_T_=' ' AND C7_EMISSAO > '20170101' GROUP BY C7_FILIAL, C7_NUM, C7_EMISSAO,SC7010.C7_X_DTCON;

UPDATE AJ7010 SET D_E_L_E_T_='*',R_E_C_D_E_L_=R_E_C_N_O_, AJ7_X_OBSA = 'APAGUEI AS AMARRACOES PARCIAIS - CAIRE VIERIA - 21/07/2017' WHERE AJ7_NUMPC IN ('117376','117358','117361','116793','116183','116798','117368','117332','101319','117365','117327','113476','112924','117379','106593','110747','117637','117313','116180','120484') ;

UPDATE AFG010 SET D_E_L_E_T_='*',R_E_C_D_E_L_=R_E_C_N_O_,AFG_X_OBSA = 'SOLICITACAO ESTAVA PARCIAL, LIMPEI TUDO - CAIRE VIEIRA 21/07/2017' WHERE AFG_NUMSC IN ('066509');
SELECT * FROM SB1010 WHERE B1_COD = '000000000007127';

SELECT * FROM SC1010 WHERE C1_X_PROJ <> ' ' AND C1_NUM NOT IN (SELECT AFG_NUMSC FROM AFG010 WHERE AFG010.D_E_L_E_T_=' ') AND SC1010.D_E_L_E_T_=' ';
UPDATE SC1010 SET C1_X_PROJ = ' ' WHERE C1_X_PROJ <> ' ' AND C1_NUM NOT IN (SELECT AFG_NUMSC FROM AFG010 WHERE AFG010.D_E_L_E_T_=' ') AND SC1010.D_E_L_E_T_=' ';

SELECT * FROM SD1010 WHERE D1_PEDIDO = '113832';
SELECT * FROM AFN010 WHERE AFN_DOC = '000723341';

SELECT * FROM AJ7010 WHERE AJ7_NUMPC = '113832';
SELECT * FROM SC7010 WHERE C7_NUM = '113832';

SELECT D1_FILIAL, AFN_PROJET, AFN_TAREFA, AFN_DOC, AFN_SERIE, D1_TOTAL, AFN_REVISA, AJ7_NUMPC, SD1.R_E_C_N_O_, TO_DATE(SD1.D1_EMISSAO,'YYYYMMDD') EMISSAO_NOTA, TO_DATE(SD1.D1_DTDIGIT,'YYYYMMDD') DIGITACAO_NOTA, SD1.D1_X_DTPMS

FROM SD1010 SD1

LEFT JOIN AJ7010 ON D1_PEDIDO = AJ7_NUMPC 
AND AJ7_ITEMPC = D1_ITEMPC 
AND AJ7_FILIAL = D1_FILIAL 
AND SD1.D_E_L_E_T_=' '

JOIN AFN010 AFN ON SD1.D1_FILIAL = AFN.AFN_FILIAL
			AND SD1.D1_DOC = AFN.AFN_DOC
			AND SD1.D1_SERIE = AFN.AFN_SERIE
			AND SD1.D1_ITEM = AFN.AFN_ITEM
			AND SD1.D1_FORNECE = AFN.AFN_FORNEC
			AND SD1.D1_LOJA = AFN.AFN_LOJA
			AND SD1.D1_COD = AFN.AFN_COD
			AND SD1.D_E_L_E_T_ = ' '
      
WHERE AJ7_NUMPC IS NULL AND AFN_DOC IS NOT NULL AND SD1.D_E_L_E_T_ = ' ' AND SD1.D1_X_DTPMS = ' ' AND D1_DTDIGIT BETWEEN '20170101'AND'20170630'
--AND AFN_PROJET = '000004' AND AFN_FILIAL = '11002'
ORDER BY D1_FILIAL, D1_DOC, SD1.D1_DTDIGIT
;

SELECT * FROM AF9010 WHERE AF9_TAREFA = '01.07       ' AND AF9_PROJET = '000004' AND AF9_FILIAL = '11002';

/*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX*/
/*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX*/
/*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX*/

UPDATE SD1010 SET D1_X_DTPMS = D1_EMISSAO WHERE R_E_C_N_O_ IN (SELECT SD1.R_E_C_N_O_

FROM SD1010 SD1

LEFT JOIN AJ7010 ON D1_PEDIDO = AJ7_NUMPC 
AND AJ7_ITEMPC = D1_ITEMPC 
AND AJ7_FILIAL = D1_FILIAL 
AND SD1.D_E_L_E_T_=' '

JOIN AFN010 AFN ON SD1.D1_FILIAL = AFN.AFN_FILIAL
			AND SD1.D1_DOC = AFN.AFN_DOC
			AND SD1.D1_SERIE = AFN.AFN_SERIE
			AND SD1.D1_ITEM = AFN.AFN_ITEM
			AND SD1.D1_FORNECE = AFN.AFN_FORNEC
			AND SD1.D1_LOJA = AFN.AFN_LOJA
			AND SD1.D1_COD = AFN.AFN_COD
			AND SD1.D_E_L_E_T_ = ' '
      
WHERE AJ7_NUMPC IS NULL AND AFN_DOC IS NOT NULL AND SD1.D_E_L_E_T_ = ' ' AND SD1.D1_X_DTPMS = ' ' AND D1_DTDIGIT BETWEEN '20170101'AND'20170531'
--AND AFN_PROJET = '000004' AND AFN_FILIAL = '11002'
)
;

SELECT * FROM SD1_BKP_DTPMS_010617 ;

SELECT * FROM SC1010 WHERE C1_NUM = '067590';
UPDATE SC1010 SET C1_QUJE = 0, C1_COTACAO = ' ',C1_FORNECE = ' ', C1_LOJA = ' ', C1_PEDIDO = ' ', C1_ITEMPED = ' ' WHERE C1_NUM = '067590'; 

SELECT * FROM SED010;

SELECT * FROM SC7010 WHERE C7_X_NTRZ = ' ' AND D_E_L_E_T_=' ';
SELECT AJ7_FILIAL, AJ7_NUMPC, AJ7_PROJET, AJ7_TAREFA FROM AJ7010 WHERE AJ7_NUMPC IN ('105311','118692','118718','118700','101319','105311','120483','120483','114043','112924','118720','106593','110747','120849','116180') 
AND D_E_L_E_T_=' ' GROUP BY AJ7_FILIAL, AJ7_NUMPC, AJ7_PROJET, AJ7_TAREFA;

SELECT * FROM SC7010 WHERE C7_NUMSC = '073469' AND D_E_L_E_T_<>'*';
SELECT * FROM AJ7010 WHERE AJ7_NUMPC = '073469' AND D_E_L_E_T_<>'*';

SELECT * FROM SC1010 WHERE C1_NUM = '071454';

SELECT * FROM C1E010;

UPDATE SC1010 SET C1_X_PROJ = ' ' WHERE C1_NUM NOT IN (SELECT AFG_NUMSC FROM AFG010 WHERE AFG010.D_E_L_E_T_=' ') AND C1_X_PROJ <> ' ';

SELECT RCE_CODIGO CODIGO, RCE_DESCRI DESCRICAO, RCE_CGC CNPJ, RCE_ENTSIN ENTIDADE, RCE_ENDER ENDERECO, RCE_NUMER NUMERO, RCE_BAIRRO BAIRRO, RCE_CEP CEP, RCE_UF ESTADO, RCE_MUNIC MUNICIPIO, RCE_MESDIS MES_DISSIDIO, RCE_X_BINS BASE_INS01, RCE__BINS2 BASE_INS02, RCE__BINS3 BASE_INS03 FROM RCE010 WHERE D_E_L_E_T_=' ' ORDER BY RCE_CODIGO, RCE_DESCRI ,RCE_CGC;

SELECT * FROM TKS010;


SELECT AJ7_FILIAL, AJ7_PROJET, AJ7_TAREFA, AJ7_NUMPC, AJ7_ITEMPC, AJ7_COD, AJ7_QUANT, C7_TOTAL  FROM AJ7010 JOIN SC7010 ON C7_ITEM = AJ7_ITEMPC AND C7_NUM = AJ7_NUMPC AND SC7010.D_E_L_E_T_=' ' WHERE AJ7_FILIAL = '11034' AND AJ7_TAREFA = '02.01' AND AJ7_PROJET = '000007' AND AJ7010.D_E_L_E_T_=' ' AND C7_X_DTCON BETWEEN '20170701'AND'20170731'
AND C7_NUM NOT IN (SELECT D1_PEDIDO FROM SD1010 WHERE SD1010.D1_X_DTPMS <> ' ' AND SD1010.D_E_L_E_T_=' ') AND AJ7_REVISA = '0002';

SELECT AFN_FILIAL, AFN_PROJET, AFN_TAREFA, AFN_DOC, AFN_SERIE, AFN_SALDCQ, AFN_FORNEC, AFN_LOJA, AFN_QUANT, D1_QUANT, D1_TOTAL FROM AFN010 JOIN SD1010 ON D1_FILIAL = AFN_FILIAL AND D1_SERIE = AFN_SERIE AND D1_DOC = AFN_DOC AND AFN_FORNEC = D1_FORNECE AND AFN_LOJA = D1_LOJA  AND AFN_ITEM = D1_ITEM AND SD1010.D_E_L_E_T_=' '
WHERE D1_X_DTPMS BETWEEN '20170701'AND'20170731' AND AFN010.D_E_L_E_T_=' ' AND AFN_FILIAL = '11034' AND AFN_PROJET = '000007' AND AFN_TAREFA = '02.01' AND AFN_REVISA = '0002'; 

SELECT * FROM AF9010 WHERE AF9010.D_E_L_E_T_=' ' AND AF9_FILIAL = '11034' AND AF9_PROJET = '000007' AND AF9_TAREFA = '02.01' AND AF9_REVISA = '0002'; 

SELECT * FROM AF8010 WHERE AF8_FILIAL = '11001' AND D_E_L_E_T_=' ';
SELECT * FROM AF9010 WHERE AF9_FILIAL = '11001' AND D_E_L_E_T_=' ' AND AF9_PROJET = '000008' AND AF9_TAREFA = '01.01' AND AF9_REVISA = '0002';
SELECT * FROM AJ7010 JOIN SC7010 ON C7_NUM = AJ7_NUMPC AND C7_ITEM = AJ7_ITEMPC AND C7_FILIAL = AJ7_FILIAL AND SC7010.D_E_L_E_T_=' ' WHERE AJ7_FILIAL = '11001' AND AJ7010.D_E_L_E_T_=' ' AND AJ7_PROJET = '000008' AND AJ7_TAREFA = '01.01' AND AJ7_REVISA = '0002' AND (AJ7_X_OBSI LIKE '%06/10/2017%' OR AJ7_X_OBSA LIKE '%06/10/2017%');

