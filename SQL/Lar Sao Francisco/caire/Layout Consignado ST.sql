SELECT 

DISTINCT

RA_FILIAL FILIAL,

 /*CASE 
 WHEN RA_FILIAL = '11001' THEN */'53221255000140'/* 
 WHEN RA_FILIAL = '11002' THEN '53221255000221' 
 WHEN RA_FILIAL = '11004' THEN '53221255000493' 
 WHEN RA_FILIAL = '11006' THEN '53221255000655' 
 WHEN RA_FILIAL = '11007' THEN '53221255000736' 
 WHEN RA_FILIAL = '11008' THEN '53221255000817' 
 WHEN RA_FILIAL = '11010' THEN '53221255001031' 
 WHEN RA_FILIAL = '11012' THEN '53221255001201' 
 WHEN RA_FILIAL = '11013' THEN '53221255001384' 
 WHEN RA_FILIAL = '11014' THEN '53221255001465' 
 WHEN RA_FILIAL = '11015' THEN '53221255001546' 
 WHEN RA_FILIAL = '11016' THEN '53221255001627' 
 WHEN RA_FILIAL = '11017' THEN '53221255001708' 
 WHEN RA_FILIAL = '11019' THEN '53221255001970' 
 WHEN RA_FILIAL = '11020' THEN '53221255002003' 
 WHEN RA_FILIAL = '11021' THEN '53221255002194' 
 WHEN RA_FILIAL = '11022' THEN '53221255002275' 
 WHEN RA_FILIAL = '11023' THEN '53221255002356' 
 WHEN RA_FILIAL = '11025' THEN '53221255002518' 
 WHEN RA_FILIAL = '11027' THEN '53221255002780' 
 WHEN RA_FILIAL = '11028' THEN '53221255002860' 
 WHEN RA_FILIAL = '11029' THEN '53221255002941' 
 WHEN RA_FILIAL = '11030' THEN '53221255003085' 
 WHEN RA_FILIAL = '11031' THEN '53221255003166' 
 WHEN RA_FILIAL = '11032' THEN '53221255003247' 
 WHEN RA_FILIAL = '11033' THEN '53221255003328' 
 WHEN RA_FILIAL = '11034' THEN '53221255003409' 
 WHEN RA_FILIAL = '11037' THEN '53221255003751' 
 WHEN RA_FILIAL = '11038' THEN '53221255003832' 
 WHEN RA_FILIAL = '11039' THEN '53221255003913' 
 WHEN RA_FILIAL = '11040' THEN '53221255004057' 
 WHEN RA_FILIAL = '11041' THEN '53221255004138' 
 WHEN RA_FILIAL = '11042' THEN '53221255004219' 
 WHEN RA_FILIAL = '11045' THEN '53221255004561' 
 WHEN RA_FILIAL = '11047' THEN '53221255004723' 
 WHEN RA_FILIAL = '11049' THEN '53221255004995' 
 WHEN RA_FILIAL = '11051' THEN '53221255005100' 
 WHEN RA_FILIAL = '11052' THEN '53221255005290' 
 WHEN RA_FILIAL = '11053' THEN '53221255005371' 
 WHEN RA_FILIAL = '11054' THEN '53221255005452' 
 WHEN RA_FILIAL = '11055' THEN '53221255005533' 
 WHEN RA_FILIAL = '11056' THEN '53221255005614' 
 WHEN RA_FILIAL = '11057' THEN '53221255005703' 
 WHEN RA_FILIAL = '11058' THEN '53221255005886' 
 WHEN RA_FILIAL = '11059' THEN '53221255005967' 
 WHEN RA_FILIAL = '11060' THEN '53221255006009' 
 WHEN RA_FILIAL = '11501' THEN '51660082000131' 
 WHEN RA_FILIAL = '11502' THEN '43667179000148' 
 WHEN RA_FILIAL = '11503' THEN '10217271000157' 
 WHEN RA_FILIAL = '11504' THEN '51660082000131' 
 WHEN RA_FILIAL = '11505' THEN '77329423000184' 
 WHEN RA_FILIAL = '11506' THEN '05520492000160' 
 WHEN RA_FILIAL = '12001' THEN '19611676000140' 
ELSE ' ' END*/ CNPJ,

RA_CIC CPF,

RA_NOMECMP NOME,

RA_MAT MATRICULA,

/*RA_SALARIO SALARIO_BASE,*/

COALESCE((SELECT SUM(CASE WHEN RD_PD <> '725' THEN RD_VALOR *-1 ELSE RD_VALOR END) FROM SRD010 WHERE RD_PD IN ('725','401','402','491','403','405','495') AND RD_MAT = RA_MAT AND RD_FILIAL = RA_FILIAL AND SRD010.D_E_L_E_T_<>'*' AND RD_DATARQ = TO_CHAR(ADD_MONTHS(sysdate,-1), 'YYYYMM') ),
(SELECT SUM(CASE WHEN RD_PD <> '725' THEN RD_VALOR *-1 ELSE RD_VALOR END) FROM SRD010 WHERE RD_PD IN ('725','401','402','491','403','405','495') AND RD_MAT = RA_MAT AND RD_FILIAL = RA_FILIAL AND SRD010.D_E_L_E_T_<>'*' AND RD_DATARQ = TO_CHAR(ADD_MONTHS(sysdate,-2), 'YYYYMM') ),
MAX(RA_SALARIO)) SALARIO,

(SUBSTR(RA_ADMISSA,7,2)||'/'||SUBSTR(RA_ADMISSA,5,2)||'/'||SUBSTR(RA_ADMISSA,1,4)) ADMISSAO,

TRUNC(MONTHS_BETWEEN(SYSDATE,TO_DATE(RA_ADMISSA,'YYYYMMDD'))) TEMPO,

/*RJ_DESC FUNCAO,*/

Q3_DESCSUM CARGO,

SUM(NVL(RK_VALORTO - RK_VLRPAGO,0)) PARCELAS,

SUM(NVL(RK_VALORPA,0)) VLR_PARCELA,

COALESCE((SELECT SUM(CASE WHEN RD_PD <> '725' THEN RD_VALOR *-1 ELSE RD_VALOR END) FROM SRD010 WHERE RD_PD IN ('725','401','402','491','403','405','495') AND RD_MAT = RA_MAT AND RD_FILIAL = RA_FILIAL AND SRD010.D_E_L_E_T_<>'*' AND RD_DATARQ = TO_CHAR(ADD_MONTHS(sysdate,-1), 'YYYYMM') ),
(SELECT SUM( CASE WHEN RD_PD <> '725' THEN RD_VALOR *-1 ELSE RD_VALOR END) FROM SRD010 WHERE RD_PD IN ('725','401','402','491','403','405','495') AND RD_MAT = RA_MAT AND RD_FILIAL = RA_FILIAL AND SRD010.D_E_L_E_T_<>'*' AND RD_DATARQ = TO_CHAR(ADD_MONTHS(sysdate,-2), 'YYYYMM') ),
MAX(RA_SALARIO)) - SUM(NVL(RK_VALORPA,0))  MARGEM

FROM SRA010 

/*LEFT JOIN SRJ010 ON RJ_FUNCAO = RA_CODFUNC AND SRJ010.D_E_L_E_T_=' '*/
LEFT JOIN SZ3010 ON Z3_X_COD = RA_X_CPLAN AND RA_X_CPLAN !=' ' AND SZ3010.D_E_L_E_T_=' '
LEFT JOIN SQB010 ON QB_DEPTO = RA_DEPTO AND SQB010.D_E_L_E_T_=' '
LEFT JOIN SRG010 ON RG_MAT = RA_MAT AND RG_FILIAL = RA_FILIAL AND SRG010.D_E_L_E_T_=' ' AND RG_DATADEM = RA_DEMISSA AND RA_DEMISSA != ' '
LEFT JOIN SQ3010 ON Q3_CARGO = RA_CARGO AND SQ3010.D_E_L_E_T_=' '
LEFT JOIN SRK010 ON RK_MAT = RA_MAT AND RK_FILIAL = RA_FILIAL AND SRK010.D_E_L_E_T_=' ' AND RK_PARCELA <> RK_PARCPAG AND RK_QUITAR IN (' ','2')

WHERE SRA010.D_E_L_E_T_= ' ' 
AND TRUNC(MONTHS_BETWEEN(SYSDATE,TO_DATE(RA_ADMISSA,'YYYYMMDD'))) >= 12
AND RA_DEMISSA = ' ' AND SUBSTR(RA_FILIAL,1,3) = '110' AND RA_MAT < '900000' AND RA_AFASFGT IN ('Q','R','P','F',' ') AND RA_TPCONTR = '1'

GROUP BY RA_FILIAL, RA_CIC, RA_NOMECMP, RA_MAT, RA_ADMISSA, RA_CARGO, Q3_DESCSUM

ORDER BY RA_FILIAL, RA_NOMECMP

;

SELECT * FROM CTD010 WHERE CTD_ITEM LIKE '%01804201%';
UPDATE CTD010 SET CTD_ITEM = REPLACE((CTD_ITEM),'"','') WHERE D_E_L_E_T_=' ';
SELECT * FROM CTD010 WHERE CTD_DESC01 LIKE '%MARIA APARECIDA COSTA%';
SELECT * FROM CT2010 WHERE CT2_ITEMC IN ('F01804001') OR CT2_ITEMD IN ('F01804001');


SELECT * FROM SRK010 WHERE RK_PD IN ('115','118','211','245','508','419') AND D_E_L_E_T_=' ' ;
UPDATE SRK010 SET D_E_L_E_T_='*',R_E_C_D_E_L_=R_E_C_N_O_ WHERE RK_PD IN ('115','118','211','245','508','419') AND D_E_L_E_T_=' ' ;
