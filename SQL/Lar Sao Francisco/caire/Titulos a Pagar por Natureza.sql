SELECT 

SD1.D1_FILIAL,
SD1.D1_SERIE,
SD1.D1_DOC,
SA2.A2_NOME FORNECEDOR,
TO_DATE(SD1.D1_DTDIGIT,'YYYYMMDD') DIGITACAO,
TO_DATE(SD1.D1_EMISSAO,'YYYYMMDD') EMISSAO,
SUM(SD1.D1_TOTAL) NOTA,
SUM(SE2.E2_VALOR) TITULO,
SUM(SE2.E2_IRRF) IRRF,
SUM(SE2.E2_INSS) INSS,
SUM(SE2.E2_ISS) ISS,
SEV.EV_PERC,
SD1.D1_CC

FROM SD1010 SD1

JOIN SA2010 SA2 ON SUBSTR(A2_FILIAL,1,2) = SUBSTR(D1_FILIAL,1,2) AND A2_COD = D1_FORNECE AND A2_LOJA = D1_LOJA AND SA2.D_E_L_E_T_<>'*' 
LEFT JOIN SEV010 SEV ON EV_FILIAL = D1_FILIAL AND EV_PREFIXO = D1_SERIE AND EV_NUM = D1_DOC AND EV_CLIFOR = D1_FORNECE AND EV_LOJA = D1_LOJA AND SEV.D_E_L_E_T_<>'*'
LEFT JOIN SE2010 SE2 ON E2_FILIAL = D1_FILIAL AND E2_PREFIXO = D1_SERIE AND E2_NUM = D1_DOC AND E2_FORNECE = D1_FORNECE AND E2_LOJA = D1_LOJA AND SE2.D_E_L_E_T_<>'*'

WHERE
D1_FILIAL BETWEEN '11001' AND '11001'
AND D1_DTDIGIT BETWEEN '20181201' AND '20190110'
AND D1_EMISSAO BETWEEN '20181201' AND '20181231'
AND D1__NATURE BETWEEN ' ' AND 'ZZZZZZZZZZ'
AND D1_X_USR BETWEEN ' ' AND 'ZZZZZZ'

GROUP BY SD1.D1_FILIAL,
SD1.D1_SERIE,
SD1.D1_DOC,
SA2.A2_NOME,
SD1.D1_DTDIGIT,
SD1.D1_EMISSAO,
SEV.EV_PERC,
SD1.D1_CC
;
